<div fxLayout="row">
  <div fxFlex="100">
    <h3 *ngIf="character.sequenceNumber == null || character.sequenceNumber <= 1">{{character.name}}</h3>
    <h3 *ngIf="character.sequenceNumber != null && character.sequenceNumber > 1">{{character.name}} {{character.sequenceNumber}}</h3>
  </div>
</div>

<div fxLayout="row">
  <div fxFlex="100">
    <button mat-raised-button color="primary" [matMenuTriggerFor]="menu">
      {{text.getText().manageCharacterLabel}}
      <mat-icon>keyboard_arrow_down</mat-icon>
    </button>
    <mat-menu #menu="matMenu">
      <button *ngIf="!isSkirmishMode" mat-menu-item
              (click)="onAddToFight()">{{text.getText().addToFightLabel}}</button>
      <button *ngIf="!isSkirmishMode" mat-menu-item
              (click)="onAddManyToFight()">{{text.getText().addManyToFightLabel}}</button>
      <button mat-menu-item (click)="onEditCharacter()">{{text.getText().editCharacterLabel}}</button>
      <button mat-menu-item (click)="onDeleteCharacter()">{{text.getText().deleteCharacterLabel}}</button>
      <button *ngIf="!isSkirmishMode" mat-menu-item (click)="onCopyCharacter()">{{text.getText().copyCharacterLabel}}</button>
    </mat-menu>
    <button mat-raised-button color="primary" *ngIf="isSkirmishMode"
            (click)="onReceiveDamage()">{{text.getText().dealDamageLabel}}</button>
    <button mat-raised-button color="primary" *ngIf="isSkirmishMode"
            (click)="onAddCondition()">{{text.getText().addConditionLabel}}</button>

  </div>
</div>

<div fxLayout="row" class="details-row" *ngIf="character.description != ''">
  <div fxFlex="100">
    <h4>{{text.getText().descriptionLabel}}</h4>
    {{character.description}}
  </div>
</div>

<div fxLayout="row" class="details-row">
  <div fxFlex="100">
    <h4>{{text.getText().groupLabel}}</h4>
    {{character.group}}
  </div>
</div>

<div *ngIf="isSkirmishMode">
  <div fxLayout="row" class="details-row">
    <div fxFlex="100">
      <h4>{{text.getText().temporaryParametersLabel}}</h4>
      <table mat-table [dataSource]="[character]" class="mat-elevation-z8">
        <ng-container matColumnDef="isAlive">
          <th mat-header-cell *matHeaderCellDef>{{text.getText().isAliveLabel}}</th>
          <td mat-cell *matCellDef="let element">
            <span *ngIf="element.isDead">Nie</span>
            <span *ngIf="!element.isDead">Tak</span>
          </td>
        </ng-container>
        <ng-container matColumnDef="currentWounds">
          <th mat-header-cell *matHeaderCellDef>{{text.getText().woundsLabel}}</th>
          <td mat-cell *matCellDef="let element">
            {{element.currentWounds}}/{{element.wounds.value}}
          </td>
        </ng-container>
        <ng-container matColumnDef="initiative">
          <th mat-header-cell *matHeaderCellDef>{{text.getText().initiativeLabel}}</th>
          <td mat-cell *matCellDef="let element">
            {{element.skirmishInitiative}}
          </td>
        </ng-container>
        <ng-container matColumnDef="advantage">
          <th mat-header-cell *matHeaderCellDef>{{text.getText().advantageLabel}}</th>
          <td mat-cell *matCellDef="let element">
            {{element.advantage}}
            <button mat-mini-fab color="basic" type="button" style="margin-left: 20px" (click)="addAdvantagePoint()">
              +
            </button>
            <button mat-mini-fab color="basic" type="button" (click)="removeAdvantagePoint()">
              -
            </button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="temporaryParametersColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: temporaryParametersColumns;"></tr>
      </table>
    </div>
  </div>
</div>


<div fxLayout="row" class="details-row">
  <div fxFlex="100">
    <h4>{{text.getText().characteristicsLabel}}</h4>
    <table mat-table [dataSource]="[character]" class="mat-elevation-z8">
      <ng-container matColumnDef="{{column}}" *ngFor="let column of characteristicsColumns">
        <th mat-header-cell *matHeaderCellDef>{{text.getCharacteristicNameTranslation(column).nameTranslation}}</th>
        <td mat-cell *matCellDef="let element">{{element.getCharacteristic(column).value}}</td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="characteristicsColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: characteristicsColumns;"></tr>
    </table>
  </div>
</div>

<ng-container *ngIf="character.notes.length > 0">
  <div fxLayout="row" class="details-row">
    <div fxFlex="100">
      <h4>{{text.getText().notesLabel}}</h4>
      <table mat-table [dataSource]="character.notes" class="mat-elevation-z8">
        <ng-container matColumnDef="note">
          <td mat-cell *matCellDef="let element">{{element}}</td>
        </ng-container>

        <tr mat-row *matRowDef="let row; columns: notesColumns;"></tr>
      </table>
    </div>
  </div>
</ng-container>


<div fxLayout="row" class="details-row">
  <div fxFlex="100">
    <h4>{{text.getText().bodyLabel}}</h4>
    <table mat-table [dataSource]="character.bodyLocalizations" class="mat-elevation-z8">
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>{{text.getText().nameLabel}}</th>
        <td mat-cell *matCellDef="let element"> {{element.bodyLocalization.nameTranslation}}</td>
      </ng-container>
      <ng-container matColumnDef="armorPoints">
        <th mat-header-cell *matHeaderCellDef>{{text.getText().armorPointsLabel}}</th>
        <td mat-cell *matCellDef="let element">
          {{element.armorPoints + element.additionalArmorPoints}} ({{element.armorPoints}})
          <ng-container *ngIf="isSkirmishMode">
            <button mat-mini-fab color="basic" type="button" style="margin-left: 20px"
                    (click)="addAdditionalArmorPoint(element)">
              +
            </button>
            <button mat-mini-fab color="basic" type="button" (click)="removeAdditionalArmorPoint(element)">
              -
            </button>
          </ng-container>
        </td>
      </ng-container>
      <ng-container matColumnDef="injuries">
        <th mat-header-cell *matHeaderCellDef>{{text.getText().injuriesLabel}}</th>
        <td mat-cell *matCellDef="let element">
          <ul>
            <li *ngFor="let characterInjury of element.injuries">
              <span *ngIf="characterInjury.value == 1">{{characterInjury.injury.nameTranslation}}</span>
              <span
                *ngIf="characterInjury.value > 1">{{characterInjury.injury.nameTranslation}} {{characterInjury.value}}</span>
            </li>
          </ul>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="bodyLocalizationsColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: bodyLocalizationsColumns;"></tr>
    </table>
  </div>
</div>

<ng-container *ngIf="character.skills.length > 0 || character.talents.length > 0 || character.traits.length > 0">

  <div fxLayout="row" fxLayoutGap="20" class="details-row">
    <ng-container *ngIf="character.skills.length > 0">
      <div fxFlex="30">
        <h4>{{text.getText().skillsLabel}}</h4>
        <table mat-table [dataSource]="character.skills" class="mat-elevation-z8">
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>{{text.getText().nameLabel}}</th>
            <td mat-cell *matCellDef="let element">
              {{element.skill.nameTranslation}}
            </td>
          </ng-container>
          <ng-container matColumnDef="level">
            <th mat-header-cell *matHeaderCellDef>{{text.getText().levelLabel}}</th>
            <td mat-cell *matCellDef="let element">
              {{element.value}}
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="baseColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: baseColumns;"></tr>
        </table>
      </div>
    </ng-container>
    <ng-container *ngIf="character.talents.length > 0">
      <div fxFlex="30">
        <h4>{{text.getText().talentsLabel}}</h4>
        <table mat-table [dataSource]="character.talents" class="mat-elevation-z8">
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>{{text.getText().nameLabel}}</th>
            <td mat-cell *matCellDef="let element">
              <span class="description-span"
                    (click)="openBottomSheet(element.talent)">
                {{element.talent.nameTranslation}}
              </span>
            </td>
          </ng-container>
          <ng-container matColumnDef="level">
            <th mat-header-cell *matHeaderCellDef>{{text.getText().levelLabel}}</th>
            <td mat-cell *matCellDef="let element">
              {{element.value}}
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="baseColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: baseColumns;"></tr>
        </table>
      </div>
    </ng-container>
    <ng-container *ngIf="character.traits.length > 0">
      <div fxFlex="30">
        <h4>{{text.getText().traitsLabel}}</h4>
        <table mat-table [dataSource]="character.traits" class="mat-elevation-z8">
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>{{text.getText().nameLabel}}</th>
            <td mat-cell *matCellDef="let element">
              <span class="description-span"
                    (click)="openBottomSheet(element.trait)">
                {{element.trait.nameTranslation}}
              </span>
            </td>
          </ng-container>
          <ng-container matColumnDef="level">
            <th mat-header-cell *matHeaderCellDef>{{text.getText().valueLabel}}</th>
            <td mat-cell *matCellDef="let element">
              {{element.value}}
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="baseColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: baseColumns;"></tr>
        </table>
      </div>
    </ng-container>
  </div>
</ng-container>

<ng-container *ngIf="character.conditions.length > 0 || character.spells.length > 0">
  <div fxLayout="row" fxLayoutGap="20" class="details-row">
    <ng-container *ngIf="character.conditions.length > 0">
      <div fxFlex="30">
        <h4>{{text.getText().conditionsLabel}}</h4>
        <table mat-table [dataSource]="character.conditions" class="mat-elevation-z8">
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>{{text.getText().nameLabel}}</th>
            <td mat-cell *matCellDef="let element">
                <span class="description-span"
                      (click)="openBottomSheet(element.condition)">
                  {{element.condition.nameTranslation}}
                </span>
            </td>
          </ng-container>
          <ng-container matColumnDef="level">
            <th mat-header-cell *matHeaderCellDef>{{text.getText().levelLabel}}</th>
            <td mat-cell *matCellDef="let element">
              {{element.value}}
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="baseColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: baseColumns;"></tr>
        </table>
      </div>
    </ng-container>
    <ng-container *ngIf="character.spells.length > 0">
      <div fxFlex="30">
        <h4>{{text.getText().spellsLabel}}</h4>
        <table mat-table [dataSource]="character.spells" class="mat-elevation-z8">
          <ng-container matColumnDef="spell">
            <th mat-header-cell *matHeaderCellDef>{{text.getText().nameLabel}}</th>
            <td mat-cell *matCellDef="let element">
                <span class="description-span"
                      (click)="openBottomSheet(element)">
                  {{element.nameTranslation}}
                </span>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="spellColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: spellColumns;"></tr>
        </table>
      </div>
    </ng-container>
  </div>
</ng-container>

<ng-container *ngIf="character.weapons.length > 0">
  <div fxLayout="row" class="details-row">
    <div fxFlex="100">
      <h4>{{text.getText().weaponLabel}}</h4>
      <table mat-table [dataSource]="character.weapons" class="mat-elevation-z8">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>{{text.getText().nameLabel}}</th>
          <td mat-cell *matCellDef="let element">
            <span *ngIf="element.value == 1; else characterWeaponValue">{{element.weapon.nameTranslation}}</span>
            <ng-template #characterWeaponValue>
              <span>{{element.weapon.nameTranslation}} ({{element.value}})</span>
            </ng-template>
          </td>
        </ng-container>
        <ng-container matColumnDef="category">
          <th mat-header-cell *matHeaderCellDef>{{text.getText().categoryLabel}}</th>
          <td mat-cell *matCellDef="let element">
            {{element.weapon.weaponGroup.nameTranslation}}
          </td>
        </ng-container>
        <ng-container matColumnDef="reach">
          <th mat-header-cell *matHeaderCellDef>{{text.getText().reachLabel}}</th>
          <td mat-cell *matCellDef="let element">
            <span
              *ngIf="element.weapon.weaponRange == 0; else weaponRange">{{element.weapon.weaponReach.nameTranslation}}
            </span>
            <ng-template #weaponRange>
              <span *ngIf="element.weapon.weaponGroup.name.includes('AMMUNITION'); else fullWeaponRange">
                <span *ngIf="element.weapon.weaponRange == 0.5">{{text.getText().halfWeaponRangeLabel}}</span>
                <span *ngIf="element.weapon.weaponRange == 1">{{text.getText().rangeAsWeaponLabel}}</span>
                <span *ngIf="element.weapon.weaponRange > 1">+{{element.weapon.weaponRange}}</span>
                <span *ngIf="element.weapon.weaponRange < 0">{{element.weapon.weaponRange}}</span>
              </span>
              <ng-template #fullWeaponRange>
                <span>{{element.weapon.weaponRange}}</span>
              </ng-template>
            </ng-template>
          </td>
        </ng-container>
        <ng-container matColumnDef="damage">
          <th mat-header-cell *matHeaderCellDef>{{text.getText().damageLabel}}</th>
          <td mat-cell *matCellDef="let element">
            <span *ngIf="element.weapon.isUsingStrength; else elseBlock">
              +{{+character.strength.value.toString()[0] + element.weapon.damage}}
            </span>
            <ng-template #elseBlock>
              <span *ngIf="element.weapon.damage >= 0; else minusDamageBlock">+{{element.weapon.damage}}</span>
              <ng-template #minusDamageBlock>
                {{element.weapon.damage}}
              </ng-template>
            </ng-template>
          </td>
        </ng-container>
        <ng-container matColumnDef="advantagesAndDisadvantages">
          <th mat-header-cell *matHeaderCellDef>{{text.getText().advantagesAndDisadvantagesLabel}}</th>
          <td mat-cell *matCellDef="let element">
            <ul>
              <li *ngFor="let quality of element.weapon.weaponQualities">
                <span *ngIf="quality.value == 1; else characterWeaponValue" class="description-span"
                      (click)="openBottomSheet(quality.weaponQuality)">
                  {{quality.weaponQuality.nameTranslation}}
                </span>
                <ng-template #characterWeaponValue>
                  <span class="description-span" (click)="openBottomSheet(quality.weaponQuality)">
                    {{quality.weaponQuality.nameTranslation}} {{quality.value}}
                  </span>
                </ng-template>
              </li>
            </ul>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="weaponColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: weaponColumns;"></tr>
      </table>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="character.armors.length > 0">
  <div fxLayout="row" class="details-row">
    <div fxFlex="100">
      <h4>{{text.getText().armorLabel}}</h4>
      <table mat-table [dataSource]="character.armors" class="mat-elevation-z8">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>{{text.getText().nameLabel}}</th>
          <td mat-cell *matCellDef="let element">
            {{element.nameTranslation}}
          </td>
        </ng-container>
        <ng-container matColumnDef="category">
          <th mat-header-cell *matHeaderCellDef>{{text.getText().categoryLabel}}</th>
          <td mat-cell *matCellDef="let element">
            {{element.armorCategory.nameTranslation}}
          </td>
        </ng-container>
        <ng-container matColumnDef="localization">
          <th mat-header-cell *matHeaderCellDef>{{text.getText().localizationLabel}}</th>
          <td mat-cell *matCellDef="let element">
            <ul>
              <li *ngFor="let localization of element.armorBodyLocalizations">
                {{localization.bodyLocalization.nameTranslation}}
              </li>
            </ul>
          </td>
        </ng-container>
        <ng-container matColumnDef="armorPoints">
          <th mat-header-cell *matHeaderCellDef>{{text.getText().armorPointsLabel}}</th>
          <td mat-cell *matCellDef="let element">
            <ul>
              <li *ngFor="let localization of element.armorBodyLocalizations">
                {{localization.armorPoints}}
              </li>
            </ul>
          </td>
        </ng-container>
        <ng-container matColumnDef="penalties">
          <th mat-header-cell *matHeaderCellDef>{{text.getText().penaltiesLabel}}</th>
          <td mat-cell *matCellDef="let element">
            <ul>
              <li *ngFor="let penalty of element.armorPenalties">
                {{penalty.nameTranslation}}
              </li>
            </ul>
          </td>
        </ng-container>
        <ng-container matColumnDef="qualities">
          <th mat-header-cell *matHeaderCellDef>{{text.getText().qualitiesLabel}}</th>
          <td mat-cell *matCellDef="let element">
            <ul>
              <li *ngFor="let quality of element.armorQualities">
                <span class="description-span"
                      (click)="openBottomSheet(quality)">
                  {{quality.nameTranslation}}
                </span>
              </li>
            </ul>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="armorsColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: armorsColumns;"></tr>
      </table>
    </div>
  </div>
</ng-container>
